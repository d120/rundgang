<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Virtueller Rundgang</title>
    <!-- https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.3/pixi.min.js -->
    <script src="js/pixi.min.js"></script>
    <script src="js/plan.js"></script>
    <link rel="stylesheet" type="text/css" href="css/plan.css">
    <style type="text/css">
        html, body {
            background-color: black;
        }
    </style>
  </head>
  <body>
    <h1>Robert-Piloty-Geb√§ude (S2|02)</h1>
    <section id="floor-0">
      <h2><a href="#floor-0">Ebene 0</a></h2>
      <canvas id="view-0"></canvas>
    </section>
    <section id="floor-1">
      <h2><a href="#floor-1">Ebene 1</a></h2>
      <canvas id="view-1"></canvas>
    </section>
    <section id="floor-2">
      <h2><a href="#floor-2">Ebene 2</a></h2>
      <canvas id="view-2"></canvas>
    </section>
    <section id="floor-3">
      <h2><a href="#floor-3">Ebene 3</a></h2>
      <canvas id="view-3"></canvas>
    </section>
    <aside id="floors">
      <a href="#floor-0">0</a>
      <a href="#floor-1">1</a>
      <a href="#floor-2">2</a>
      <a href="#floor-3">3</a>
    </aside>
    <script>
        let view0 = document.getElementById('view-0');
        floorPlan(0, view0);
        let view1 = document.getElementById('view-1');
        floorPlan(1, view1);
        let view2 = document.getElementById('view-2');
        floorPlan(2, view2);
        let view3 = document.getElementById('view-3');
        floorPlan(3, view3);

        let hash = window.location.hash;
        let floor = ["#floor-0", "#floor-1", "#floor-2", "#floor-3"].indexOf(hash);
        const sections = document.querySelectorAll("section");
        const marks = document.querySelectorAll("#floors > a");
        if (floor >= 0) {
          marks[floor].classList.add('active');
        }
        window.addEventListener("scroll", () => {
          let index = -1;
          for (const section of sections) {
            if (window.scrollY + 2 < section.offsetTop) {
              break;
            } else if (window.scrollY > section.offsetTop + 10) {
              index += 1;
            } else {
              index += 1;
              break;
            }
          }
          if (floor != index) {
            if (floor != -1) {
              marks[floor].classList.remove('active');
            }
            if (index == -1) {
              window.location.hash = '';
            } else {
              window.location.hash = `#floor-${index}`;
              marks[index].classList.add('active');
            }
            floor = index;
          }
        });
    </script>
  </body>
</html>
